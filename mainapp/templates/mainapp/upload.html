{% extends "mainapp/layout.html" %}
{% block pagename %}Upload Model{% endblock %}
{% block headadditions %}
{% load static %}
<link rel="stylesheet" href="{% static 'mainapp/lib/leaflet.css' %}">
<script src="{% static 'mainapp/lib/leaflet.js' %}"></script>
<style>
body {
	padding-bottom: 50px;
}

#map {
	margin: 0px auto;
	width: 450px;
	height: 300px;
}

#map-descriptor {
	margin-top: 5px;
	text-align: center;
}
</style>
{% endblock %}
{% block body %}
<div class="container">
	<div class="col-12">
		<h1>Upload Model</h1>
		<p>Here, you can upload a model to the repository.</p>
		<p>First, make sure to package your model correctly: make sure it's in the OBJ format, includes an MTL file, then zip these files, along with their textures. Make sure every file is in the root directory of the zip.</p>
		<p>Then, simply fill the fields below and upload your model!</p>
		<form action="{% url 'upload' %}" method="post" enctype="multipart/form-data">
			{% csrf_token %}
			<div class="form-group required">
				<label for="{{ form.title.id_for_label }}">{{ form.title.label }}:</label>
				{% for error in form.title.errors %}<div class="alert alert-danger" role="alert">{{ error }}</div>{% endfor %}
				{{ form.title }}
			</div>
			<div class="form-group">
				<label for="{{ form.description.id_for_label }}">{{ form.description.label }}:</label>
				{% for error in form.description.errors %}<div class="alert alert-danger" role="alert">{{ error }}</div>{% endfor %}
				{{ form.description }}
			</div>
			<div class="form-group">
				<label for="{{ form.tags.id_for_label }}">{{ form.tags.label }}:</label>
				{% for error in form.tags.errors %}<div class="alert alert-danger" role="alert">{{ error }}</div>{% endfor %}
				{{ form.tags }}
			</div>
			<div class="form-group">
				<label for="{{ form.categories.id_for_label }}">{{ form.categories.label }}:</label>
				{% for error in form.categories.errors %}<div class="alert alert-danger" role="alert">{{ error }}</div>{% endfor %}
				{{ form.categories }}
			</div>
			<div id="map"></div>
			<p id="map-descriptor"></p>
			<div class="form-group">
				<label for="{{ form.latitude.id_for_label }}">{{ form.latitude.label }}:</label>
				{% for error in form.latitude.errors %}<div class="alert alert-danger" role="alert">{{ error }}</div>{% endfor %}
				{{ form.latitude }}
			</div>
			<div class="form-group">
				<label for="{{ form.longitude.id_for_label }}">{{ form.longitude.label }}:</label>
				{% for error in form.longitude.errors %}<div class="alert alert-danger" role="alert">{{ error }}</div>{% endfor %}
				{{ form.longitude }}
			</div>
			<div class="form-group">
				<label for="{{ form.translation.id_for_translation }}">{{ form.translation.label }}:</label>
				{% for error in form.translation.errors %}<div class="alert alert-danger" role="alert">{{ error }}</div>{% endfor %}
				{{ form.translation }}
				<span id="translation-help" class="help-block">Specifies the translation of the model, in model units.</span>
			</div>
			<div class="form-group">
				<label for="{{ form.rotation.id_for_rotation }}">{{ form.rotation.label }}:</label>
				{% for error in form.rotation.errors %}<div class="alert alert-danger" role="alert">{{ error }}</div>{% endfor %}
				{{ form.rotation }}
				<span id="rotation-help" class="help-block">Specifies the rotation of the model, in the vertical axis. In degrees, clockwise</span>
			</div>
			<div class="form-group">
				<label for="{{ form.scale.id_for_scale }}">{{ form.scale.label }}:</label>
				{% for error in form.scale.errors %}<div class="alert alert-danger" role="alert">{{ error }}</div>{% endfor %}
				{{ form.scale }}
				<span id="scaling-help" class="help-block">Specifies the scaling of the model. '2' here would mean that each unit in the model corresponds to 2 meters.</span>
			</div>
			<div class="form-group required">
				<label>License</label>
				{% for error in form.license.errors %}<div class="alert alert-danger" role="alert">{{ error }}</div>{% endfor %}
				{% for radio in form.license %}
				<div class="radio">
					<label>{{ radio.tag}}{{ radio.choice_label }}</label>
				</div>
				{% endfor %}
			</div>
			<div class="form-group required">
				<label for="{{ form.model_file.id_for_label }}">{{ form.model_file.label }}</label>
				{% for error in form.model_file.errors %}<div class="alert alert-danger" role="alert">{{ error }}</div>{% endfor %}
				{{ form.model_file }}
			</div>
			<button type="submit" class="btn btn-default">Upload Model</button>
		</form>
	</div>
</div>
<script>
	function updateLatLon(e) {
		document.getElementById('id_latitude').value = e.latlng.lat;
		document.getElementById('id_longitude').value = ((e.latlng.lng - 180) % 360) + 180;
	}

	var map = L.map('map');
	map.on('load', function() {
		var descriptor = document.getElementById('map-descriptor');
		descriptor.innerHTML = 'Click anywhere on the map to set longitude/latitude values.';
	});
	map.setView([51.505, -0.09], 3);

	L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
		attribution: 'Map data Â© <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
		minZoom: 2,
		maxZoom: 18
	}).addTo(map);

	var marker = undefined;

	map.on('click', function(e) {
		if(marker)
			marker.remove(map);
		
		updateLatLon(e);

		marker = new L.marker(e.latlng, {draggable: true}).addTo(map);
		marker.on('drag', updateLatLon);
	});
</script>
{% endblock %}
