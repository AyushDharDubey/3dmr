{% extends "mainapp/layout.html" %}
{% block pagename %}Upload Model{% endblock %}
{% block headadditions %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.1.0/dist/leaflet.css" integrity="sha512-wcw6ts8Anuw10Mzh9Ytw4pylW8+NAD4ch3lqm9lzAsTxg0GFeJgoAtxuCLREZSC5lUXdVyo/7yfsqFjQ4S+aKw==" crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.1.0/dist/leaflet.js" integrity="sha512-mNqn2Wg7tSToJhvHcqfzLMU6J4mkOImSPTxVZAdo+lcPlk+GhZmYgACEe0x35K7YzW1zJ7XyJV/TT1MrdXvMcA==" crossorigin=""></script>
<style>
body {
	padding-bottom: 50px;
}

#map {
	margin: 0px auto;
	width: 450px;
	height: 300px;
}

#map-descriptor {
	margin-top: 5px;
	text-align: center;
}
</style>
{% endblock %}
{% block body %}
<div class="container">
	<div class="row">
		<h1>Upload Model</h1>
		<p>Here, you can upload a model to the repository.</p>
		<p>First, make sure to package your model correctly: make sure it's in the OBJ format, includes an MTL file, then zip these files, along with their textures. Make sure every file is in the root directory of the zip.</p>
		<p>Then, simply fill the fields below and upload your model!</p>
		<form action="{% url 'upload' %}" method="post" enctype="multipart/form-data">
			{% csrf_token %}
			<div class="form-group required">
				<label for="{{ form.title.id_for_label }}">{{ form.title.label }}:</label>
				{% for error in form.title.errors %}<div class="alert alert-danger" role="alert">{{ error }}</div>{% endfor %}
				{{ form.title }}
			</div>
			<div class="form-group">
				<label for="{{ form.description.id_for_label }}">{{ form.description.label }}:</label>
				{% for error in form.description.errors %}<div class="alert alert-danger" role="alert">{{ error }}</div>{% endfor %}
				{{ form.description }}
			</div>
			<div class="form-group">
				<label for="{{ form.tags.id_for_label }}">{{ form.tags.label }}:</label>
				{% for error in form.tags.errors %}<div class="alert alert-danger" role="alert">{{ error }}</div>{% endfor %}
				{{ form.tags }}
			</div>
			<div class="form-group">
				<label for="{{ form.categories.id_for_label }}">{{ form.categories.label }}:</label>
				{% for error in form.categories.errors %}<div class="alert alert-danger" role="alert">{{ error }}</div>{% endfor %}
				{{ form.categories }}
			</div>
			<div id="map"></div>
			<p id="map-descriptor"></p>
			<div class="form-group">
				<label for="{{ form.latitude.id_for_label }}">{{ form.latitude.label }}:</label>
				{% for error in form.latitude.errors %}<div class="alert alert-danger" role="alert">{{ error }}</div>{% endfor %}
				{{ form.latitude }}
			</div>
			<div class="form-group">
				<label for="{{ form.longitude.id_for_label }}">{{ form.longitude.label }}:</label>
				{% for error in form.longitude.errors %}<div class="alert alert-danger" role="alert">{{ error }}</div>{% endfor %}
				{{ form.longitude }}
			</div>
			<div class="form-group required">
				<label>License</label>
				{% for error in form.license.errors %}<div class="alert alert-danger" role="alert">{{ error }}</div>{% endfor %}
				{% for radio in form.license %}
				<div class="radio">
					<label>{{ radio.tag}}{{ radio.choice_label }}</label>
				</div>
				{% endfor %}
			</div>
			<div class="form-group required">
				<label for="{{ form.model_file.id_for_label }}">{{ form.model_file.label }}</label>
				{% for error in form.model_file.errors %}<div class="alert alert-danger" role="alert">{{ error }}</div>{% endfor %}
				{{ form.model_file }}
			</div>
			<button type="submit" class="btn btn-default">Upload Model</button>
		</form>
	</div>
</div>
<script>
	var map = L.map('map');
	map.on('load', function() {
		var descriptor = document.getElementById('map-descriptor');
		descriptor.innerHTML = 'Click anywhere on the map to set longitude/latitude values.';
	});
	map.setView([51.505, -0.09], 3);

	L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
		attribution: 'Map data Â© <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
		minZoom: 2,
		maxZoom: 18
	}).addTo(map);

	var marker = undefined;

	map.on('click', function(e) {
		if(marker)
			marker.remove(map);

		document.getElementById('id_latitude').value = e.latlng.lat;
		document.getElementById('id_longitude').value = ((e.latlng.lng - 180) % 360) + 180;

		marker = new L.marker(e.latlng).addTo(map);
	});
</script>
{% endblock %}
