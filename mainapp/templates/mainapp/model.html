{% extends "mainapp/layout.html" %}
{% block pagename %}{{ model.title }}{% endblock %}
{% block headadditions %}
{% load static %}
<script src="{% static 'mainapp/lib/three.js' %}"></script>
<script src="{% static 'mainapp/lib/OBJLoader.js' %}"></script>
<script src="{% static 'mainapp/lib/MTLLoader.js' %}"></script>
<script src="{% static 'mainapp/lib/OrbitControls.js' %}"></script>
<script src="{% static 'mainapp/lib/zip.js' %}"></script>
<script src="{% static 'mainapp/lib/zip-ext.js' %}"></script>
<script src="{% static 'mainapp/preview.js' %}"></script>
<script>
displayPreview("render-pane", 750, 480, {{ model.model_id }}, {{ model.revision }});
</script>
{% endblock %}
{% block body %}
<div class="container">
	<div class="row">
		<div class="col-md-8">
			<br>
			<ul class="nav nav-tabs" id="render-pane">
				<li class="active"><a href="#">3D View</a></li>
				<li><a href="#">Map View</a></li>
			</ul>
		</div>
		<div class="col-md-4">
			<br>
			<div class="panel panel-primary">
				<div class="panel-heading">
					<h3 class="panel-title">{{ model.title }}</h3>
				</div>
				<div class="panel-body">
					<p>Categories:
						{% for category in model.categories.all %}
						<a href="{% url 'search' %}?category={{ category.name }}"><span class="label label-default">{{ category.name }}</span></a>
						{% endfor %}
					</p>
					<p>Tags:
						{% for k, v in model.tags.items %}
						<a href="{% url 'search' %}?tag={{ k }}={{ v }}"><span class="label label-default">{{ k }}={{ v }}</span></a>
						{% endfor %}
					</p>
					<p>Description:</p>
					<p>{{ model.description }}</p>
					<p>Uploaded by <a href="{% url 'user' model.author.username %}"><span class="label label-default">{{ model.author.username }}</span></a> on {{ model.upload_date|date:"c" }}</p>
				</div>
			</div>
		</div>
	</div>
	<br>
	<div class="row">
		<div class="panel panel-primary">
			<div class="panel-heading">
				<h3 class="panel-title">Comments</h3>
			</div>
			<div class="panel-body">
				{% if user.is_authenticated %}
				<form action="{% url 'addcomment' %}" method="post">
					{% csrf_token %}
					<label for="comment">Add your comment:</label><br>
					<textarea cols="80" rows="6" id="comment" name="comment">{{ owner.profile.description }}</textarea><br>
					<input type="hidden" name="model_id" value="{{ model.model_id }}">
					<input type="hidden" name="revision" value="{{ model.revision }}">
					<button type="submit" class="btn">Submit</button>
				</form>
				<br>
				{% endif %}
				{% for comment in comments %}
				<div class="panel panel-default">
					<div class="panel-body">
						{{ comment.rendered_comment|safe }}
					</div>
					<div class="panel-footer">
						<a href="{% url 'user' comment.author.username %}">
							<span class="label label-default">{{ comment.author.username }}</span>
						</a>
						on {{ comment.datetime|date:"Y-m-d H:i" }}
						{% if model.revision != comment.model.revision %}
						(revision {{ comment.model.revision }})
						{% endif %}
					</div>
				</div>
				{% endfor %}
			</div>
		</div>
	</div>
</div>
{% endblock %}
